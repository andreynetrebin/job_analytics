# Changelog

Все заметные изменения в этом проекте будут задокументированы в этом файле.

## [1.1.0] - 2025-07-01

### Изменения

- Добавлена поддержка авторизации через HeadHunter.
- Реализован механизм получения и хранения access и refresh токенов.

### Исправления

- Исправлены ошибки в обработке ответов от API.

## [1.2.0] - 2025-07-01

### Изменения

- Обновлен URL для получения токенов на `https://api.hh.ru/token` в соответствии с новой документацией API.
- Изменен метод отправки POST запроса для получения токенов на использование `application/x-www-form-urlencoded`.
- Добавлено логирование для отслеживания ответов от API и ошибок.

### Исправления

- Исправлена ошибка 405 "Method Not Allowed" при попытке получить токен.

## [1.3.0] - 2025-07-02

### Изменения

- Переход на использование ORM для упрощения работы с базой данных.
- Настроен механизм миграций для управления изменениями в структуре базы данных.
- Добавлена функция получения информации о вакансии по ID.
- Обновлена функция поиска вакансий с поддержкой пагинации.
- Создана отдельная таблица для хранения информации о зарплатах.

## [1.4.0] - 2025-07-03

### Изменения

- Добавлена таблица временного хранения вакансий для сверки данных.
- Реализовано хранение ключевых навыков и форматов работы с использованием связи многие-ко-многим.
- Добавлено хранение профессиональных ролей в базе данных.

## [1.5.0] - 2025-07-04

### Изменения

- Добавлена функция получения информации о работодателе по ID.
- Добавлена функция для сверки временной таблицы с основной таблицей вакансий.
- Обновлена структура базы данных: добавлены таблицы для хранения информации о работодателях и отраслях, о виде
  занятости, рабочих часах и графиках работы.
- Реализовано сохранение информации о работодателях и их отраслях из API.
- Реализован модуль для запуска сбора данных о вакансиях по расписанию.

## [1.6.0] - 2025-07-05

### Изменения

- Добавлена админская часть для обработки заявок на получение аналитической информации по поисковым запросам.
- Реализована пользовательская часть с возможностью отправки заявок на получение аналитической информации.
- Обновлена функция получения вакансий, теперь параметры текста подставляются из базы `search_queries`
  с `is_active = True`.

## [1.7.0] - 2025-07-07

### Изменения

- Декомпозиция модуля job_analytics.

## [1.8.0] - 2025-07-14

### Изменения

- Добавлены таблицы для хранения информации с учетом историчности о ключевых навыках и зарплате.
- Реализована обработка кейса возобновления вакансии.

## [1.9.0] - 2025-07-15

### Исправления

- Исправлено извлечение и сохранение данных о вакансиях и работодателях.

## [1.10.0] - 2025-07-20

### Изменения

- Реализовано возобновление архивных вакансий с обновлением статуса и историй.
- Добавлено обновление истории зарплаты при изменении данных о зарплате.
- Обновление ключевых навыков с учетом новых и ушедших навыков из вакансии.

## [1.11.0] - 2025-07-21

### Изменения

- Добавлена логика обработки вакансий, отсутствующих среди текущих полученных вакансий:
    - Запрос актуального статуса для каждой отсутствующей вакансии.
    - Обновление статуса на "Архивный" с записью в `VacancyStatusHistory`, если статус архивный.
    - Логирование для активных вакансий, которые не попали в сбор.
- Исправлена ошибка с вычитанием "naive" и "aware" объектов `datetime` в функции обновления статуса вакансии.

## [1.12.0] - 2025-07-22

### Изменения

- Добавлен ретрай сбора информации по вакансиям, упавшим с ошибкой.
- Реализован функционал отправки уведомлений на электронную почту о новых вакансиях на email.
- Исправлен метод отправки электронной почты:
    - Обновлен код функции `send_email` для использования SSL при отправке писем.
    - Добавлена обработка ошибок для более детального логирования проблем с аутентификацией и подключением к
      SMTP-серверу.

## [1.13.0] - 2025-07-23

### Изменения

- Добавлена обработка вакансий с кодом 404:
    - Вакансии, для которых при проверке статуса API возвращает 404, теперь добавляются в отдельный список для
      отслеживания.
    - Логирование для вакансий с отсутствующим статусом.
- Обновлены отношения в моделях `Industry` и `Employer`:
    - Добавлен параметр `overlaps` для устранения предупреждений о конфликте отношений.
- Переход на использование OAuth 2.0 с доступом к API Google для отправки писем:
    - Реализована аутентификация через OAuth 2.0.
    - Обновлены функции для работы с токенами доступа и обновления токенов.

## [1.14.0] - 2025-07-24

### Изменения

- Функция `create_email_body` была вынесена в `util.py`.
- Улучшен внешний вид таблицы в письме уведомления:
    - Добавлены стили для таблицы.
    - Добавлены ссылки на вакансии и работодателя.
    - Расширена информация о работодателе (рейтинг, количество оценок, it-аккредитация).
    - Создана новая таблица топ-10 ключевых навыков по количеству вакансий.

## [1.15.0] - 2025-07-28

### Изменения

- Изменена связь на "многие-ко-многим" между Вакансиями и Поисковыми запросами.
- В уведомлении вакансии сортируются по количеству оценок работодателя в порядке убывания.

## [1.16.0] - 2025-07-29

### Изменения

- Выделен модуль для REST API. Созданы несколько endpoint'ов:
    - get_average_salaries для получения средней зарплаты по валюте.
    - get_vacancies_by_work_format для получения вакансий по формату работы.
    - get_vacancies_by_experience для получения вакансий по уровню опыта.
    - get_vacancies_by_professional_role для получения вакансий по профессиональной роли.
    - get_salary_experience_correlation для анализа корреляции между зарплатой и уровнем опыта.
    - get_top_skills для получения списка востребованных навыков.
    - get_industries для получения списка отраслей.
- Изменена организация подключения к базе данных с использованием пула соединений.

## [1.17.0] - 2025-07-31

### Изменения

- Изменен способ получения идентификаторов вакансий в `existing_vacancy_ids`, теперь используется `external_id`
  вместо `id`.
- Добавлен пункт меню "Request a Search Query" на главной странице для отправки заявок пользователями.
- Обновлено оформление всех страниц для улучшения пользовательского интерфейса.
- В уведомлении о новых вакансиях изменена сортировка на `open_vacancies` по убыванию.

## [1.18.0] - 2025-08-03

### Изменения

- Добавлен пункт меню "Дашборды в Grafana" и страница со ссылками на дашборды в Grafana.
- Добавлена отправка уведомления на e-mail Админа о создании новой заявки пользователем. 
